<?php if (count($errors)) foreach($errors as $k=>$err) { ?>
	Поле <?php echo isset($fields[$k]['title']) ? $fields[$k]['title'] : $k ?> имеет некорректное значение<br />
<?php } ?>
<form action="<?php echo $P->siteUrl($info['ControllerUrl'].'/edit/'.$id) ?>" 
	  method="post" id="form_<?php echo $table ?>" enctype="multipart/form-data">
<?php foreach($data as $k=>$v) {
	if ($k==$info['primaryKey'])
		continue;
	$i = isset($fields[$k]) ? $fields[$k] : false;
	if (isset($i['hide']))
		continue;
	?>
	<p>
		<label<?php if (isset($errors[$k])) echo ' class="err"'; ?>>
			<?php echo isset($i['title']) ? $i['title'] : $k ?></label>
		<?php
		if (isset($methods['editor_'.ucfirst($k)]))
			echo call_user_func($class.'::editor_'.ucfirst($k), $v, $data);
		elseif (isset($lookup[$k]))
		{
			?><select name="data[<?php echo $k ?>]">
				<option value="0" <?php
					if (!isset($lookup[$k][$v])) echo 'selected="selected"';
					?>> -- Не указано -- </option>
			<?php foreach ($lookup[$k] as $id=>$value) {?>
				<option value="<?php echo $id ?>" <?php 
					if ($id == $v) echo 'selected="selected"';
					?>><?php echo $this->esc($value) ?></option>
			<?php } ?></select><?php
		} else { ?>
		<input type="text" 
			   name="data[<?php echo $k ?>]"
			   default="<?php echo $this->esc($v) ?>"
			   <?php //добавляем валидатор, если он указан для поля
			   if (isset($methods['validator_'.ucfirst($k)]))
					echo 'meta:validator="'.ucfirst($k).'"';
				?>
		/>
		<?php } ?>
	</p>
<?php } ?>
	<input type="submit" value="Отправить" name="send" />
</form>
